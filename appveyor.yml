version: '{build}'
branches:
  only:
    - master
image:
  - Visual Studio 2017
platform:
  - Win32
  - x64
configuration:
  - Release
install:
  - cmd: copy golded3\mygolded.__h golded3\mygolded.h
build:
  parallel: true
  project: golded.vs2017.sln
after_build:
  cmd: 7z a golded-plus-%PLATFORM%.zip windows/bin/%CONFIGURATION%/%PLATFORM%/*.exe
artifacts:
  - path: golded-plus-*.zip
before_deploy:
  - echo on
    & for /f "usebackq delims=" %%a in (`git log --pretty^=format:%%cd -n 1`) do set TIMESTAMP="%%a"
    & for /f "usebackq delims=" %%a in (`ruby -e 'require "time"^; print Time::parse^(ENV["TIMESTAMP"]^).strftime^("%%Y%%m%%d_%%H%%M%%S"^)'`) do set TIMESTAMP=%%a
deploy:
- provider: BinTray
  username: askovpen
  api_key:
    secure: tMeaumPwuXUoehCCRudxUm5bjBOmz7ZWkmpE1zM6/mZBBgEgJxBJ3yajiBpKcZ6J
  subject: askovpen
  repo: test
  package: golded-plus
  publish: true
  version: $(TIMESTAMP)
  override: true
  on:
    branch: master
